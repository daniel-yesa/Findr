<!DOCTYPE html>
<html>
<head>
    <title>Findr | YESA</title>
    <link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet" />
    <!-- Litepicker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />

    <style>
        body {
            background-color: #121212;
            font-family: 'Segoe UI', sans-serif;
            color: #f0f0f0;
            padding: 2rem;
        }
        h1, h2 {
            color: #00ffcc;
        }
        .container {
            max-width: 960px;
            margin: auto;
        }
        input, textarea, button, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #1e1e1e;
            border: 1px solid #333;
            color: white;
            border-radius: 8px;
        }
        button {
            background: #00ffcc;
            color: black;
            font-weight: bold;
            border: none;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            background: #00e6b8;
        }
        .spinner {
            display: none;
            margin-top: 10px;
        }
        .spinner.show {
            display: block;
        }
        table {
            width: 100%;
            margin-top: 1rem;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #222;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üîé Findr - PSU Check</h1>
    <form method="POST" enctype="multipart/form-data" onsubmit="document.getElementById('spinner').classList.add('show');">
        <label>üì§ Upload Booked Sales CSV:</label>
        <input type="file" name="csv_file" required>

        <label for="date-range">üìÖ Select Booked Date Range</label>
        <input
          type="text"
          id="date-range"
          name="date_range"
          required
          placeholder="Click to select date range"
          class="bg-gray-800 text-white border border-gray-600 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
        />

        <label>üîó Paste Google Sheet URL:</label>
        <input type="url" name="sheet_url" value="https://docs.google.com/spreadsheets/d/1tamMxhdJ-_wuyCrmu9mK6RiVj1lZsUJBSm0gSBbjQwM/edit#gid=1075311190" required>

        <label>üßæ Name of Appealer:</label>
        <input type="text" name="appealer_name" required>

        <button type="submit">üöÄ Run Report</button>
        <div id="spinner" class="spinner">‚è≥ Processing, please wait...</div>
    </form>

    {% if mismatches %}
        <h2>üßæ Mismatched Accounts</h2>
        <table>
            <thead>
                <tr>
                    {% for col in mismatches[0].keys() %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in mismatches %}
                    <tr>
                        {% for value in row.values() %}
                            <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% if ontario %}
        <h2>üìç Ontario Open Appeals</h2>
        <table>
            <thead>
                <tr>
                    {% for col in ontario[0].keys() %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in ontario %}
                    <tr>
                        {% for value in row.values() %}
                            <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% if quebec %}
        <h2>üìç Quebec Open Appeals</h2>
        <table>
            <thead>
                <tr>
                    {% for col in quebec[0].keys() %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in quebec %}
                    <tr>
                        {% for value in row.values() %}
                            <td>{{ value }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dr = document.querySelector('#date_range');
        $(dr).daterangepicker({
            opens: 'right',
            autoApply: true,
            locale: {
                format: 'YYYY-MM-DD'
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
<script>
  const picker = new Litepicker({
    element: document.getElementById("date-range"),
    singleMode: false,
    format: "M/D/YYYY",
    numberOfMonths: 2,
    dropdowns: {
      minYear: 2023,
      maxYear: null,
      months: true,
      years: true,
    }
  });
</script>
</body>
</html>
