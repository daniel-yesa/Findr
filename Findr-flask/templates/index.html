<!DOCTYPE html>
<html>
<head>
    <title>Findr | YESA</title>
    <link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet" />
    <!-- Litepicker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />

    <style>
        body {
            overflow-x: hidden;
            background-color: #121212;
            font-family: 'Segoe UI', sans-serif;
            color: #f0f0f0;
            padding: 2rem;
        }
        h1, h2 {
            color: #00ffcc;
        }
        .container {
            max-width: 960px;
            margin: auto;
        }
        input, textarea, button, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #1e1e1e;
            border: 1px solid #333;
            color: white;
            border-radius: 8px;
        }
        button {
            background: #00ffcc;
            color: black;
            font-weight: bold;
            border: none;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            background: #00e6b8;
        }
        .spinner {
            display: none;
            margin-top: 10px;
        }
        .spinner.show {
            display: block;
        }
        table {
            table-layout: auto;
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #222;
        }
      .litepicker {
        background-color: #1e1e2f;
        color: #f5f5f5;
        border: 1px solid #333;
        font-family: 'Segoe UI', sans-serif;
        box-shadow: 0 0 10px rgba(0,0,0,0.6);
      }
      .litepicker .container__days .day-item {
        background-color: transparent;
        color: #f5f5f5;
      }
      .litepicker .container__days .day-item.is-today {
        border: 1px solid #888;
      }
      .litepicker .container__days .day-item.is-selected {
        background-color: #4f46e5;
        color: #fff;
        border-radius: 4px;
      }
      .litepicker .month-item {
        background-color: #1e1e2f;
      }
      .litepicker .container__months .month-item-header {
        color: #ccc;
      }
      .litepicker .button-apply,
      .litepicker .button-cancel {
        background-color: #4f46e5;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
      }
      table.excel-style {
          width: 100%;
          border-collapse: collapse;
          font-family: monospace;
          font-size: 14px;
          margin-bottom: 30px;
      }
      table.excel-style th, table.excel-style td {
          border: 1px solid #ccc;
          padding: 6px 10px;
          white-space: pre;
      }
      table.excel-style th {
          background-color: #f2f2f2;
      }
    </style>
</head>
<body>
<div class="container">
    <h1>üîé Findr - Account Discrepencies</h1>
    <form method="POST" enctype="multipart/form-data" onsubmit="document.getElementById('spinner').classList.add('show');">
        <label>üì§ Upload Booked Sales CSV:</label>
        <input type="file" name="csv_file" required>

        <label for="date-range" class="block text-sm font-medium mb-1 text-gray-200">üìÖ Booked Date Range</label>
        <input
          type="text"
          id="date-range"
          name="date_range"
          required
          placeholder="Click to select a range"
          class="bg-gray-900 text-white border border-gray-700 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
        />

        <label>üîó Paste Google Sheet URL:</label>
        <input type="url" name="sheet_url" value="https://docs.google.com/spreadsheets/d/1tamMxhdJ-_wuyCrmu9mK6RiVj1lZsUJBSm0gSBbjQwM/edit?gid=719546440#gid=719546440" required>

        <label>üßæ Name of Appealer:</label>
        <input type="text" name="appealer_name" required>

        <button type="submit">üöÄ Run Report</button>
        <div id="spinner" class="spinner">‚è≥ Checking, please wait...</div>
    </form>

    {% if summary %}
      <div style="margin-top: 30px; margin-bottom: 10px; background: #1d1d1d; border: 1px solid #444; border-radius: 8px; padding: 16px;">
        <h3 style="color: #00ffcc; margin-bottom: 8px;">üìä Summary</h3>
        <p><strong>Accounts Checked:</strong> {{ summary.accounts_checked }}</p>
        <p><strong>Mismatched Accounts:</strong> {{ summary.total_mismatches }} (Ontario: {{ summary.ontario_mismatches }} | Quebec: {{ summary.quebec_mismatches }})</p>
      </div>
    {% endif %}
    
    {% if mismatches %}
        <h2>üßæ Mismatched Accounts</h2>
        <div style="overflow-x:auto;">
          <table class="excel-style">
            <thead>
              <tr>
                {% for col in mismatches[0].keys() %}
                  <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in mismatches %}
                <tr>
                  {% for value in row.values() %}
                    <td>{{ value }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
    {% endif %}

    {% if ontario %}
        <h3>Ontario Open Appeals</h3>
        <div style="overflow-x:auto;">
          <table class="excel-style">
            <thead>
              <tr>
                {% for col in ontario[0].keys() %}
                  <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in ontario %}
                <tr>
                  {% for val in row.values() %}
                    <td>{{ val }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
    {% endif %}

    {% if quebec %}
        <h3>Quebec Open Appeals</h3>
        <div style="overflow-x:auto;">
          <table class="excel-style">
            <thead>
              <tr>
                {% for col in quebec[0].keys() %}
                  <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in quebec %}
                <tr>
                  {% for val in row.values() %}
                    <td>{{ val }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js"></script>
<script>
  new Litepicker({
    element: document.getElementById("date-range"),
    singleMode: false,
    numberOfMonths: 2,
    numberOfColumns: 2,
    format: "M/D/YYYY",
    autoApply: true,
    dropdowns: {
      minYear: 2023,
      maxYear: null,
      months: true,
      years: true
    },
    setup: (picker) => {
      picker.on('selected', () => {
        document.getElementById("date-range").classList.add("filled");
      });
    }
  });
</script>
</body>
</html>
