<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Findr</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <!-- Date Range Picker CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <style>
        body {
            background-color: #0d0d0d;
            color: #ff0033;
            font-family: 'Share Tech Mono', monospace;
            text-align: center;
            padding: 30px;
        }
        h1 {
            font-size: 2.5rem;
            text-shadow: 0 0 8px #ff0033, 0 0 15px #ff0033;
            margin-bottom: 20px;
        }
        .form-container {
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #ff0033;
            box-shadow: 0 0 15px #ff0033;
            padding: 20px;
            width: 90%;
            max-width: 700px;
            margin: 0 auto 40px auto;
            border-radius: 10px;
        }
        input, button {
            font-family: inherit;
            font-size: 1rem;
            margin: 8px 0;
            padding: 10px;
            border-radius: 5px;
            border: none;
            width: 100%;
            box-sizing: border-box;
        }
        input[type="text"], input[type="file"] {
            background-color: #1a1a1a;
            color: #ff0033;
            border: 1px solid #ff0033;
        }
        /* Smaller date range picker */
        #date_range {
            font-size: 0.9rem;
            padding: 8px;
        }
        button {
            background-color: #ff0033;
            color: #0d0d0d;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #ff0033, 0 0 20px #ff0033;
        }
        button:hover {
            background-color: #e60029;
            box-shadow: 0 0 20px #ff0033, 0 0 30px #ff0033;
            transform: scale(1.05);
        }
        .copy-btn {
            margin-bottom: 10px;
            width: auto;
            padding: 8px 16px;
            display: inline-block;
        }
        .table-container {
            margin: 40px auto;
            width: fit-content;
            max-width: 100%;
            text-align: center;
        }
        table {
            border-collapse: collapse;
            background-color: white;
            font-size: 0.9rem;
            min-width: 800px;
            box-shadow: 0 0 15px #ff0033;
        }
        th, td {
            border: 1px solid #ff0033;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #ff0033;
            color: #ffffff;
            text-align: center;
        }
        tr:nth-child(even) td {
            background-color: #f8f8f8;
        }
        tr:nth-child(odd) td {
            background-color: #ffffff;
        }
        /* Make the date range calendar display properly */
        .daterangepicker {
            min-width: 300px !important;
            max-width: 360px !important;
        }
        
        .daterangepicker .calendar-table {
            table-layout: fixed;
            width: 100%;
        }
        
        .daterangepicker .calendar {
            float: left;
            width: 50% !important;
        }
        
        .daterangepicker.show-calendar {
            display: flex !important;
            flex-wrap: nowrap;
            justify-content: center;
        }
    </style>
</head>
<body>

<h1>Findr â€” Open Appeals Finder</h1>

<div class="form-container">
    <form method="POST" enctype="multipart/form-data">
        <label>Upload CSV File:</label>
        <input type="file" name="csv_file" required>

        <label>Google Sheet URL:</label>
        <input type="text" name="sheet_url" placeholder="https://docs.google.com/spreadsheets/..." required>

        <label>Date Range:</label>
        <input type="text" name="date_range" id="date_range" required>

        <label>Appealer Name:</label>
        <input type="text" name="appealer_name" placeholder="Enter your name" required>

        <button type="submit">Run Report</button>
    </form>
</div>

{% if summary %}
<div>
    <h2>Summary</h2>
    <p>Accounts Checked: {{ summary.accounts_checked }}</p>
    <p>Total Mismatches: {{ summary.total_mismatches }}</p>
    <p>Ontario Mismatches: {{ summary.ontario_mismatches }}</p>
    <p>Quebec Mismatches: {{ summary.quebec_mismatches }}</p>
</div>

<div class="table-container">
    <h2>Ontario Open Appeals</h2>
    <button class="copy-btn" onclick="copyTable('ontarioTable')">Copy Table</button>
    <table id="ontarioTable">
        <thead>
            <tr>
                {% for col in ontario[0].keys() %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in ontario %}
            <tr>
                {% for col in row.values() %}
                <td>{{ col }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="table-container">
    <h2>Quebec Open Appeals</h2>
    <button class="copy-btn" onclick="copyTable('quebecTable')">Copy Table</button>
    <table id="quebecTable">
        <thead>
            <tr>
                {% for col in quebec[0].keys() %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in quebec %}
            <tr>
                {% for col in row.values() %}
                <td>{{ col }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Date Range Picker JS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script>
    $('#dateRange').daterangepicker({
        opens: 'center',
        autoApply: true,
        locale: { format: 'YYYY-MM-DD' }
    });

    function copyTable(tableId) {
        let range, sel;
        let table = document.getElementById(tableId);
        if (document.createRange && window.getSelection) {
            range = document.createRange();
            sel = window.getSelection();
            sel.removeAllRanges();
            try {
                range.selectNodeContents(table);
                sel.addRange(range);
            } catch (e) {
                range.selectNode(table);
                sel.addRange(range);
            }
            document.execCommand("copy");
            sel.removeAllRanges();
            alert("Table copied to clipboard!");
        }
    }
</script>

</body>
</html>
